<script>
window.addEventListener("DOMContentLoaded", () => {

/* ===== Renderer ===== */
const renderer = new THREE.WebGLRenderer({ antialias:true })
renderer.setSize(window.innerWidth, window.innerHeight)
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))
renderer.toneMapping = THREE.ACESFilmicToneMapping
renderer.toneMappingExposure = 1.15
document.body.appendChild(renderer.domElement)

/* ===== Scene ===== */
const scene = new THREE.Scene()

const camera = new THREE.PerspectiveCamera(
45,
window.innerWidth/window.innerHeight,
0.1,
2000
)
camera.position.set(0,0,160)

/* ===== Lighting ===== */
scene.add(new THREE.AmbientLight(0xffffff,0.4))

const pinkLight = new THREE.PointLight(0xff4f81,3,1000)
pinkLight.position.set(0,60,80)
scene.add(pinkLight)

/* ===== Starfield ===== */
const starGeo = new THREE.BufferGeometry()
const starCount = 3000
const starPositions = new Float32Array(starCount*3)

for(let i=0;i<starCount*3;i++){
  starPositions[i] = (Math.random()-0.5)*900
}

starGeo.setAttribute("position", new THREE.BufferAttribute(starPositions,3))

const starMat = new THREE.PointsMaterial({
  color:0xffffff,
  size:1.2,
  transparent:true,
  opacity:0.7
})

const stars = new THREE.Points(starGeo,starMat)
scene.add(stars)

/* ===== Sparkle Particles (NEW) ===== */
const sparkleGeo = new THREE.BufferGeometry()
const sparkleCount = 800
const sparklePositions = new Float32Array(sparkleCount*3)

for(let i=0;i<sparkleCount;i++){
  const angle = Math.random() * Math.PI * 2
  const radius = 40 + Math.random()*20

  sparklePositions[i*3] = Math.cos(angle) * radius
  sparklePositions[i*3+1] = Math.sin(angle) * radius
  sparklePositions[i*3+2] = (Math.random()-0.5)*30
}

sparkleGeo.setAttribute("position", new THREE.BufferAttribute(sparklePositions,3))

const sparkleMat = new THREE.PointsMaterial({
  color:0xffb6d9,
  size:2,
  transparent:true,
  opacity:0.9
})

const sparkles = new THREE.Points(sparkleGeo,sparkleMat)
scene.add(sparkles)

/* ===== Halo Ring (Soft Glow) ===== */
const haloGeo = new THREE.RingGeometry(45,55,64)
const haloMat = new THREE.MeshBasicMaterial({
  color:0xff4f81,
  transparent:true,
  opacity:0.2,
  side:THREE.DoubleSide
})

const halo = new THREE.Mesh(haloGeo,haloMat)
halo.rotation.x = Math.PI/2
scene.add(halo)

/* ===== Heart ===== */
const heartShape = new THREE.Shape()
heartShape.moveTo(0,0)
heartShape.bezierCurveTo(0,8,-12,18,-22,6)
heartShape.bezierCurveTo(-28,-5,-8,-18,0,-28)
heartShape.bezierCurveTo(8,-18,28,-5,22,6)
heartShape.bezierCurveTo(12,18,0,8,0,0)

const heartGeo = new THREE.ExtrudeGeometry(heartShape,{
depth:10,
bevelEnabled:true,
bevelSegments:16,
bevelSize:2,
bevelThickness:2,
curveSegments:60
})
heartGeo.center()

const heart = new THREE.Mesh(
heartGeo,
new THREE.MeshPhysicalMaterial({
color:0xff2e88,
metalness:0.6,
roughness:0.15,
clearcoat:1
})
)
scene.add(heart)

/* ===== Animation ===== */
const clock = new THREE.Clock()
let introProgress = 0

function animate(){
requestAnimationFrame(animate)

const delta = clock.getDelta()
const elapsed = clock.getElapsedTime()

introProgress = Math.min(1, introProgress + delta * 0.5)
camera.position.z = 160 - introProgress * 90

heart.rotation.y += delta * 0.8
heart.rotation.x = Math.sin(elapsed*0.6)*0.05
heart.scale.setScalar(1 + Math.sin(elapsed*1.5)*0.05)

stars.rotation.y += delta * 0.03

sparkles.rotation.y += delta * 0.4
sparkles.material.opacity = 0.6 + Math.sin(elapsed*3)*0.3

halo.scale.setScalar(1 + Math.sin(elapsed*2)*0.05)
halo.material.opacity = 0.15 + Math.sin(elapsed*2)*0.05

renderer.render(scene,camera)
}
animate()

/* ===== Music ===== */
const music = document.getElementById("music")
music.volume = 0

function fadeInAudio(){
  let vol = 0
  const fade = setInterval(()=>{
    if(vol < 1){
      vol += 0.05
      music.volume = vol
    } else {
      clearInterval(fade)
    }
  },200)
}

/* ===== UI ===== */
document.getElementById("enterBtn").addEventListener("click",()=>{
  music.play().then(()=>{ fadeInAudio() }).catch(()=>{})
  document.getElementById("enterScreen").style.display="none"
  document.getElementById("question").style.display="block"
  document.getElementById("ui").style.display="block"
})

document.getElementById("yes").onclick = ()=>{
document.getElementById("ui").style.display="none"
document.getElementById("question").style.display="none"
document.getElementById("final").style.display="block"
}

document.getElementById("no").onmouseover = ()=>{
const btn = document.getElementById("no")
const padding = 120
btn.style.position="absolute"
btn.style.left = Math.random()*(window.innerWidth-padding)+"px"
btn.style.top = Math.random()*(window.innerHeight-padding)+"px"
}

window.addEventListener("resize",()=>{
camera.aspect = window.innerWidth/window.innerHeight
camera.updateProjectionMatrix()
renderer.setSize(window.innerWidth,window.innerHeight)
})

})
</script>
